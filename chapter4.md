# 四、格式化建議





## 術語說明

區塊化結構是指一個類別、方法或建構子的本體。而後面將會提到，一個陣列的初始化樣式也可視為是種區塊化結構。

#### **4.1 括號(Braces)**

>4.1.1 即使不是必要的大括號，仍應加上(Braces are used where optional)

在使用```if, else, for, do ```和 ```while``` 等程式敘述時都必須加上大括號，即使方法本體可能是空白的或是內容只有單行。

>4.1.2 不是空白的區塊： 使用K &R 風格(Nonempty blocks: K & R style)

本體不是空的大括號或是由大括號所組成的結構，應遵守Kernighan and Ritchie style原則：

1. 在起使大括號前不應換行
1. 在起始大括號後進行換行
1. 在結束大括號前應換行
1. 若是結束大括號意味著一段程式敘述的終點，像是方法本體、建構子本體、Class本體，其後必須換行。相對的、像是else敘述或逗號後即可不換行。

例如：

    return new MyClass() {

      @Override public void method() {
  
        if (condition()) {
          try {
            something();
          } catch (ProblemException e) {
            recover();
          }
        }
      }

    };

但有些例外狀況，像是Enum類別的運用，這部分將在後面提到。

>4.1.3 空的區塊： 讓他簡潔一些(Empty blocks: may be concise)

一個空區塊或是區塊式結構可能在起始大括號後立刻結束，其中可能沒有任何字元或換行的情形在內，如```{ }```。除非該區塊包含在一個多重區塊的程式敘述中，如```if-else if-else``` 或```try- catch-finally```

例如：

```void doNothing() {}```

#### **4.2 與區塊相關的縮排**

當一個新的區塊或區塊式結構以起始大括號開啟後，每下一個階層皆以兩個空白作為縮排，當區塊結束時，縮排回覆到與起始大括號相同階層處。縮排階層適用於同區塊內的程式碼及註解。

#### **4.3 每一行只有一程式敘述**

每行敘述結束皆應換行。

#### **4.4 字元數限制：80~100個字元數**

不同的專案可以自由的決定限制每行敘述應介於80 ~ 100字元數間。而若有可能超過限制的程式碼應遵守**line-wrappped**，但有例外：

1. 可預期無法遵守限制的程式碼，如在Javadoc中一段較長的URL，或是較長的JavaScript Native Interface參照（把一個 Java method 宣告成「native」然後用另一個語言來實做內容。
）
1. package或import敘述
1. 在註解中可能被用來複製貼上到shell的命令行指令(command line)

#### **4.5 Line-wrapping**


**line-wrapping**：在避免違反字元數限制的情況下，將一行合法的程式敘述拆分成多行的動作，就稱為line-wrapping

並沒有明確的、決定性的公式可用來決定不同情況下如何line-wrapping，一般而言，有多種方法都可在同樣的程式碼中利用。有時候可能透過將方法拆分或採取另外宣告區域變數的方式就可以解決必須line wrapping的需求

>4.5.1 在何處換行

比較理想的換行原則是根據高層次的語意進行判斷：

1. 當遇到非賦值(assign)的運算符號時，應在其前換行。如```+```號，若必須換行，則```+```號必須在下一行開始。（**留意**：這不適用於其他遵守Google Style 風格的語言，如JavaScipt 或 C++）
此條件也適用於一些類似運算符號的其他符號，如： 

 * 
點```.```、在型別限定Parameterized中的```&```符號(```<T extends ClassA & ClassB>```)、在catch區塊的(```|```)符號```catch（SQLException | IOException）```

1. 
當遇到賦值運算符號時，應在其後換行，但在其前換行亦可接受。如```=```號，應在等號後方換行。此條件也適用於一些類賦值符號，如```foreach```
1. 
建構子及方法的名稱應與起始小括號在同一行，其後再換行
1. 
逗號會與它前面的token在同一行，其後再換行

>4.5.2 自動換行時應至少有4個空白的縮排

當進行line - wrapping時，換行後的程式敘述應與同一敘述的首行有4個空白的縮排。

當同一敘述有多行連續換行時，縮排應多於4個空白。一般而言，當兩個連續行起始於語法上同級的元素時，他們可以屬於同個縮排層級

使用不同數量的空白以垂直對齊前一行的Token不是個合適的作法。

#### **4.6 空白**

>4.6.1 垂直的空白(Vertical Whitespace )

單行空白會出現在：

1. 類別成員連續的排列時，如：建構子、屬性、方法、巢狀類別、static 初始化、實例初始化。
**例外**： 在兩個連續的屬性宣告間的空白行不是必要的，有時候這樣的空白是為了用來建立邏輯性的群組屬性。
1. 
在方法本體內，為程式敘述建立邏輯性的群組
1. 
在類別內的第一個成員之前或最後一個成員之後，可以選擇性的留一行空白
1. 
文件中其他篇章的建議或要求

允許多行空白，但非必要。

>4.6.2 水平的空白(Horizontal whitespace)

除了程式語言本身的要求或其他編碼風格的規則，註解、Javadoc和英文字詞間的空白以外，ASCII 空白只應出現在以下幾種情況：

1. 分隔同一行內，Java關鍵字與緊跟其後的起始小括號```(```，如
```if、for、catch```。
1. 分隔同一行內，結束小括號```)```與緊跟其後的Java關鍵字，如
```else、catch```。
1. 在任何起始大括號```{```前，但有兩個例外：
 >A. annotation，如 ```@CucumberOptions({a,b})``` 

 >B. 初始化陣列時，如```String[][] arrays ={{"elemnet"}};```

1. 在任何位元運算子及三元運算子的兩側，也同樣適用於下列的類運算符號，如

  >A.用在聯結型別的```&```符號，例:```<T extends ClassA & ClassB>```
  
  >B.用在聯結catch區塊內不同例外的```|```符號，例: 
  >```catch (SQLException se | IOException ie)```
  
  >C.用在foreach區塊內的```:```符號，例```foreach(String ele : new String[] {“1”,”2”} )```
  
1. 在符號```,:;``` 之後或是型別轉換(cast) 的結束小括號後。
2. 在符號 ```//```的兩側，通常是接在一行程式敘述結束而必須註解時。這也允許多個空白，但非必要。
3. 在宣告型別時，型別與變數之間應有空白，例String word;
4. 在初始化陣列時，可以選擇性的在大括號內使用空白，如```new int[] {5, 6 }``` 可以接受，或```new int[] {5, 6}```。

 **留意**：這項條件並未特別規定當遇到行的開頭或結尾時是否需要額外的空白，僅限於大括號的內部。

>4.6.3 水平層次上的對齊： 沒有必要


##術語說明

**水平對齊**： 是在程式碼中，以不同數量的空白試圖讓某一 Token 在上下文的 Token中看起來有垂直對齊。

儘管這樣的動作是可被接受的，但在 Google Style中是不需要的。甚至沒必要去維護曾試圖達成水平對齊的程式碼。

下面的範例描述原本沒有對齊的程式碼如何刻意的去對齊：

 
```private int x;``` // this is fine

```private Color color;``` // this too

```private int       x;```      // permitted, but future edits

```private Color color;```  // may leave it unaligned


