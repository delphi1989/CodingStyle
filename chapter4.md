# 四、格式化建議





## 術語說明

區塊化結構是指一個類別、方法或建構子的本體。而後面將會提到，一個陣列的初始化樣式也可視為是種區塊化結構。

#### **4.1 括號(Braces)**

>4.1.1 即使不是必要的大括號，仍應加上(Braces are used where optional)

在使用```if, else, for, do ```和 ```while``` 等程式敘述時都必須加上大括號，即使方法本體可能是空白的或是內容只有單行。

>4.1.2 不是空白的區塊： 使用K &R 風格(Nonempty blocks: K & R style)

本體不是空的大括號或是由大括號所組成的結構，應遵守Kernighan and Ritchie style原則：

1. 在起使大括號前不應換行
1. 在起始大括號後進行換行
1. 在結束大括號前應換行
1. 若是結束大括號意味著一段程式敘述的終點，像是方法本體、建構子本體、Class本體，其後必須換行。相對的、像是else敘述或逗號後即可不換行。

例如：

    return new MyClass() {

      @Override public void method() {
  
        if (condition()) {
          try {
            something();
          } catch (ProblemException e) {
            recover();
          }
        }
      }

    };

但有些例外狀況，像是Enum類別的運用，這部分將在後面提到。

>4.1.3 空的區塊： 讓他簡潔一些(Empty blocks: may be concise)

一個空區塊或是區塊式結構可能在起始大括號後立刻結束，其中可能沒有任何字元或換行的情形在內，如```{ }```。除非該區塊包含在一個多重區塊的程式敘述中，如```if-else if-else``` 或```try- catch-finally```

例如：

```void doNothing() {}```

#### **4.2 與區塊相關的縮排**

當一個新的區塊或區塊式結構以起始大括號開啟後，每下一個階層皆以兩個空白作為縮排，當區塊結束時，縮排回覆到與起始大括號相同階層處。縮排階層適用於同區塊內的程式碼及註解。

#### **4.3 每一行只有一程式敘述**

每行敘述結束皆應換行。

#### **4.4 字元數限制：80~100個字元數**

不同的專案可以自由的決定限制每行敘述應介於80 ~ 100字元數間。而若有可能超過限制的程式碼應遵守**line-wrappped**，但有例外：

1. 可預期無法遵守限制的程式碼，如在Javadoc中一段較長的URL，或是較長的JavaScript Native Interface參照（把一個 Java method 宣告成「native」然後用另一個語言來實做內容。
）
1. package或import敘述
1. 在註解中可能被用來複製貼上到shell的命令行指令(command line)

#### **4.5 Line-wrapping**


**line-wrapping**：在避免違反字元數限制的情況下，將一行合法的程式敘述拆分成多行的動作，就稱為line-wrapping

並沒有明確的、決定性的公式可用來決定不同情況下如何line-wrapping，一般而言，有多種方法都可在同樣的程式碼中利用。有時候可能透過將方法拆分或採取另外宣告區域變數的方式就可以解決必須line wrapping的需求

>4.5.1 在何處換行

比較理想的換行原則是根據高層次的語意進行判斷：

1. 當遇到非賦值(assign)的運算符號時，應在其前換行。如```+```號，若必須換行，則```+```號必須在下一行開始。（**留意**：這不適用於其他遵守Google Style 風格的語言，如JavaScipt 或 C++）
此條件也適用於一些類似運算符號的其他符號，如： 

 * 
點```.```、在型別限定Parameterized中的```&```符號(```<T extends ClassA & ClassB>```)、在catch區塊的(```|```)符號```catch（SQLException | IOException）```

1. 
當遇到賦值運算符號時，應在其後換行，但在其前換行亦可接受。如```=```號，應在等號後方換行。此條件也適用於一些類賦值符號，如```foreach```
1. 
建構子及方法的名稱應與起始小括號在同一行，其後再換行
1. 
逗號會與它前面的token在同一行，其後再換行

>4.5.2 自動換行時應至少有4個空白的縮排

當進行line - wrapping時，換行後的程式敘述應與同一敘述的首行有4個空白的縮排。

當同一敘述有多行連續換行時，縮排應多於4個空白。一般而言，當兩個連續行起始於語法上同級的元素時，他們可以屬於同個縮排層級

使用不同數量的空白以垂直對齊前一行的Token不是個合適的作法。

#### **4.6 空白**

>4.6.1 垂直的空白(Vertical Whitespace )

單行空白會出現在：

1. 類別成員連續的排列時，如：建構子、屬性、方法、巢狀類別、static 初始化、實例初始化。
**例外**： 在兩個連續的屬性宣告間的空白行不是必要的，有時候這樣的空白是為了用來建立邏輯性的群組屬性。
1. 
在方法本體內，為程式敘述建立邏輯性的群組
1. 
在類別內的第一個成員之前或最後一個成員之後，可以選擇性的留一行空白
1. 
文件中其他篇章的建議或要求

允許多行空白，但非必要。

>4.6.2 水平的空白(Horizontal whitespace)

除了程式語言本身的要求或其他編碼風格的規則，註解、Javadoc和英文字詞間的空白以外，ASCII 空白只應出現在以下幾種情況：

1. 分隔同一行內，Java關鍵字與緊跟其後的起始小括號```(```，如
```if、for、catch```。
1. 分隔同一行內，結束小括號```)```與緊跟其後的Java關鍵字，如
```else、catch```。
1. 在任何起始大括號```{```前，但有兩個例外：
 >A. annotation，如 ```@CucumberOptions({a,b})``` 

 >B. 初始化陣列時，如```String[][] arrays ={{"elemnet"}};```

1. 在任何位元運算子及三元運算子的兩側，也同樣適用於下列的類運算符號，如

  >A.用在聯結型別的```&```符號，例:```<T extends ClassA & ClassB>```
  
  >B.用在聯結catch區塊內不同例外的```|```符號，例: 
  >```catch (SQLException se | IOException ie)```
  
  >C.用在foreach區塊內的```:```符號，例```foreach(String ele : new String[] {“1”,”2”} )```
  
1. 在符號```,:;``` 之後或是型別轉換(cast) 的結束小括號後。
2. 在符號 ```//```的兩側，通常是接在一行程式敘述結束而必須註解時。這也允許多個空白，但非必要。
3. 在宣告型別時，型別與變數之間應有空白，例String word;
4. 在初始化陣列時，可以選擇性的在大括號內使用空白，如```new int[] {5, 6 }``` 可以接受，或```new int[] {5, 6}```。

 **留意**：這項條件並未特別規定當遇到行的開頭或結尾時是否需要額外的空白，僅限於大括號的內部。

>4.6.3 水平層次上的對齊： 沒有必要


##術語說明

**水平對齊**： 是在程式碼中，以不同數量的空白試圖讓某一 Token 在上下文的 Token中看起來有垂直對齊。

儘管這樣的動作是可被接受的，但在 Google Style中是不需要的。甚至沒必要去維護曾試圖達成水平對齊的程式碼。

下面的範例描述原本沒有對齊的程式碼如何刻意的去對齊：

 
```private int x;``` // this is fine

```private Color color;``` // this too

```private int   x;```     // 主要是這行的變數x透過空白試圖與下方的變數color對齊

```private Color color;```  // may leave it unaligned


**提醒**： 儘管對齊有助於程式可讀性，但也可能對未來的維護造成影響。若未來在維護或更新時僅需要更動程式碼中的一列，這項改變可能造成原先令人滿意的格式受到破壞，而這是被允許的。常見的是，這項改變會提醒coder應同時調整附近幾行程式碼，甚至造成一連串的重新格式化。原先一行程式碼的改變造成了大範圍的影響。如此可能造成毫無意義的工作，甚至破壞了不同版本間的歷史資訊，降低了閱讀者的速度也造成程式碼在merge時發生衝突的可能性。

#### **4.7 以小括號進行分組**

只有當閱讀者及程式碼的作者，都認為不會因省略掉小括號而誤解程式碼的，以及程式碼更容易的閱讀時，可以選擇性的省略小括號。你不能預期每個閱讀者都能完整的記住Java中不同運算元的執行順序

#### **4.8 特定的結構**

>4.8.1 列舉類別( Enum classes)

你可以在每個列舉常數的逗號後選擇性地換行。在一個沒有方法及說明文件，只有常數存在的列舉類別中，他可以使用像是陣列初始化的格式，如```private enum Suit { Clubs, Hearts , Spades, Diamonds }```。因為列舉也屬於一類別，因此也適用其他用來格式化類別的規則。

>4.8.2 變數宣告(Variable declarations)

>>4.8.2.1 一次只宣告一個變數(Variable declarations)

無論是區域變數或是屬性，一次只宣告一個變數，而不使用像是```int a, b;```的宣告格式

>>4.8.2.2

區域變數不應總是宣告在他所屬的程式區塊或類似區塊結構的開頭，相反地，區域變數常被宣告在他將被初次使用的位置前，以最小化他的有效範圍。區域變數通常都會在宣告後立刻被初始化，或是在被宣告時就進行初始化。

---

>4.8.3 陣列(Arrays)

>>4.8.3.1 陣列的初始化： 可用區塊式結構

陣列在初始化時可以被格式化成像是程式區塊的樣子，而下面的例子皆為有效的陣列初始化：

    new int[ ] {
      0, 1, 2, 3
    }

    new int[ ] {
      0,
      1,
      2,
      3,
    }
    new int[ ] {
      0, 1,
      2, 3
    }
    new int[]
      { 0, 1, 2, 3}

>>4.8.3.2 不要以C語言風格的方式宣告陣列

陣列的代表符號中括號應屬於型別的一部分，而不是變數的一部分，例如：
是```String[ ] args``` , 而不是```String args[ ]```

---

>4.8.4 Switch敘述


## 術語說明

在switch的程式敘述區塊內有一個或一個以上的程式敘述群組，每個敘述群組是由一個或一個以上的switch 標籤所組成（像是```case: Foo``` 或像是 ```default:```  ），再接著一個以上的敘述。


>>4.8.4.1 縮排

像是其他的程式區塊一樣，switch區塊的本體也是以2個空白做為縮排層級。在每個switch標籤後都將換行，而下一行也將有2個white space 的縮排，就是像是一個小區塊的起始標記。而之後的每個switch標籤會恢復到原本的縮排層級（跟第一個標籤相同），像是一個小區塊的結束標記。

>>4.8.4.2 Fall-through: 註解

在每一個 switch 區塊內，每個敘述群組可能突然地中斷Switch流程（像是以關鍵字 ```break, continue,  return 或是throw an Exception``` ），或是由註解標記，程式可能將繼續進入下一個敘述群組執行。而用來標記這種行為的註解是必要的（通常像是 ```// fall through``` ）。而在最後一個switch小區塊則可不必有這樣的註解。如： 

    switch (input) {
      case 1:

      case 2:
        prepareOneOrTwo();
        // fall through

      case 3:
        handleOneTwoOrThree();
        break;

      default:
        handleLargeNumber(input);

    }

>>4.8.4.3 必須有default標籤

每個switch區塊都應有default敘述群組，即使switch區塊內沒有程式碼。

---

>4.8.5 Annotation

使用在方法、類別或建構子上的Annotation，會緊接著出現在文件區塊後。而每個Annotation像是清單一樣單獨佔據一行。而這樣的分行並非是因執行 line - wrapping，因此縮排的層級並未增加。例如：

    @Override
    @Nullable
    public String getNameIfPresent() { ... }
    
但有**例外**：當只有一個Annotation，且該Annotation並沒有參數時，可能與方法簽章存在於同一行，像是：    

    @Override public int multiply() { ... }
    
使用在屬性上的Annotation也會緊接著出現在文件區塊後，但這樣的狀況下，多個Annotation的宣告（可能是型別限定）可以列在同一行，列如：    

    @Partial @Mock DataLoader loader;

而針對使用在方法參數及區域變數上的Annotation並沒有特定的規則進行格式化。

>4.8.6 註解

>>4.8.6.1 區塊註解風格

註解區塊跟周圍的程式碼有相同層級的縮排，他們可能使用```/* … */```的風格或是 ```// …``` 的風格。針對多行的註解``` /* … */``` ，後續的每一行應由 ```*```  起始，並且跟前一行的 ```*``` 垂直對齊。
例如：

    /*
    * This is      // And so      /* Or you can
    * okay.        // is this.     * even do this. */
    */

註解區塊並非由星字符號或其他的字元封裝

**Tips**:當在敘述多行註解時，使用```/*…*/```的風格，若希望自動化格式程式碼的工具能重新包裹註解內的某行（意指換行時自動格式化），多數的工具並不會重新包裹 ```//…``` 這樣風格的註解。







